\section{Introduction}\label{sec:introduction}
\noindent Trends of increasing data availability as well as increasing system complexity provide opportunities for data driven-driven control%make a compelling case for data-driven control methods as an alternative to model-based approaches
~\citep{Hou2013}. %~\citep{Markovsky2023}. %
In sharp contrast to the use of data in %Whilst data can be used with
indirect data-driven approaches to synthesise a model by means of system identification, direct data-driven control approaches are promising because of their ability to derive a control law directly from data without having to realize an explicit system model as an often expensive intermediate step~\citep{Hjalmarsson2005}.

A direct \ac{DDPC} method called \acf{DeePC} is developed in~\cite{Coulson2019} and has recently seen considerable development and successful implementation~\citep{Markovsky2023}. \ac{DeePC} relies on Willems' Fundamental Lemma in a receding horizon optimal control framework. This lemma reveals that for a deterministic \ac{LTI} system, any sufficiently persistently exciting input-output trajectory parameterizes all possible future input-output trajectories~\citep{Willems2005}.

% Since its conception in~\cite{Coulson2019}, a form of direct data-driven control called \ac{DeePC} has seen considerable development. \ac{DeePC} uses Willems' Fundamental Lemma from the field of behavioural systems theory, which states that for a deterministic system any sufficiently persistently exciting input-output trajectory parameterizes all possible future input-output trajectories~\cite{Willems2005}. In effect, \ac{DeePC} exploits Willems' Fundamental Lemma in a receding horizon optimal control framework found also in \ac{MPC}.
For non-deterministic systems, care has to be taken with such a parameterization in terms of only past input-output trajectories because this does not consider the effects of noise. If the block-Hankel data matrix in which the noisy input-output trajectories are stored is full rank then unattainable future trajectories may be predicted~\citep{Markovsky2023}. On the other hand, if the data matrix is rank-deficient, then the \ac{DeePC} problem may be infeasible. To deal with noise, slack variables and regularization initially served as heuristic measures to introduce robustness~\citep{Coulson2019}, and subsequently have been motivated formally to, e.g., provide robust closed-loop stability guarantees~\citep{Berberich2021}, distributional robustness~\citep{Coulson2019a}, and robustness to structured uncertainty~\citep{Huang2023}. Other approaches to handle noise include averaging techniques~\citep{Jo2022}, singular value based thresholding~\citep{Sassella2022}, and the use of maximum likelihood estimation~\citep{Yin2023}. See also~\cite{Sassella2023} for a discussion of such methods, or \cite{Verheijen2023} for a practical review of several \ac{DDPC} methods.% that consider noise.

To fundamentally address the consequences of noise in a data-driven setting, an \ac{IV} approach is presented in~\cite{vanWingerden2022}. %A fundamentally different noise-mitigation technique is the use of \acf{IVs}.
Using \ac{IVs} to mitigate noise, this method %
%These are employed in~\cite{vanWingerden2022} to mitigate noise and to
demonstrates the equivalence between \ac{DeePC} and a subspace identification-inspired direct \ac{DDPC} method called \ac{SPC} from~\cite{Favoreel1999}\footnote{This equivalence is also shown by~\cite{Fiedler2021} using regularizations and in a noiseless setting.}. The established equivalence provides opportunities for in-depth analysis and further development of the direct \ac{DDPC} techniques by the strong fundamental basis of subspace identification methods. %The equivalence has many profound implications due to the connection with subspace identification, which has a strong fundamental basis.

The correlation between inputs and noise that arises from feedback results in closed-loop identification bias~\citep{Soderstrom1989a}. %One such a result is that in closed-loop inputs become correlated with noise, resulting in closed-loop identification bias~\citep{Soderstrom1989a}. 
\cite{Dinkla2023} demonstrate that this problem can arise with batch-wise adaptive\footnote{In batch-wise adaptive operation, subsequent controllers employ closed-loop data from only a single controller. This paper considers (fully) adaptive implementations whereby the controller is updated at each time step.} \ac{SPC} and (given the aforementioned equivalence also) \ac{DeePC} applications, potentially degrading controller performance. To tackle the closed-loop identification issue, the preliminary original results in~\cite{Dinkla2023} suggest using \ac{IVs} and sequential step-ahead predictions. The use of these suggestions is further confirmed in the work of~\cite{Wang2023} and~\cite{Shi2023}. In a subspace paradigm, the idea of sequential step-ahead predictions is also used by \acf{CL-SPC}~\citep{Dong2008}. %Although it has been established that the closed-loop identification issue also affects \ac{DeePC}, so far this issue has only been exemplified using \ac{SPC}. Moreover, dedicated 
%Dedicated closed-loop direct \ac{DDPC} methods mostly employ a subspace paradigm, as with \acf{CL-SPC}~\citep{Dong2008}.

Although data-driven control algorithms have seen considerable development, to date, optimal noise mitigation under feedback is not completely addressed.
The few existing efforts have focused on using either \ac{IVs} or a sequential step-ahead predictor. The aim of this paper is to rigorously develop \ac{CL-DeePC}, thereby providing a unifying framework of different solution strategies that addresses closed-loop identification bias. %A concerted effort that unifies these approaches in a rigorously developed behavioural \ac{DDPC} framework is currently lacking. %
%Two suggestions of~\cite{Dinkla2023} to tackle the closed-loop identification issue concern the use of \ac{IVs} and the use of sequential step-ahead predictions. The former suggestion motivates the parallel work of~\cite{Wang2023}, wherein the authors rely on knowledge of a non-adaptive controller to address this issue. The latter suggestion features in the concurrent work of~\cite{Shi2023} and is rigorously developed here using \ac{IVs} to mitigate noise. %
%
%In \citet{Wang2023} a \ac{CL-DeePC} algorithm is therefore developed that makes use of \ac{IVs} to solve this issue. Another solution to this problem is to avoid correlation between inputs and noise by using a one-step-ahead predictor~\citep{Ljung1996}. This idea is employed in~\cite{Dong2008} to develop \ac{CL-SPC}, which does not suffer from this closed-loop identification issue.
%
% To date all solutions of the closed-loop identification issue in direct data-driven predictive control applications are based on a subspace framework, as with \ac{CL-SPC}. Although the \textit{original} \ac{SPC} and \ac{DeePC} algorithms are equivalent, no behavioural approach has yet been developed that deals with closed-loop identification bias.
%The two methods that address the closed-loop issue in the behavioural framework of \ac{DeePC} either lack structural noise mitigation by means of \ac{IVs} or assume complete knowledge of a constant controller. %

The main contributions of this paper are: 
%To date all solutions to deal with noise in closed-loop direct data-driven predictive control are either based on a subspace framework, as with \ac{CL-SPC}, or rely on \ac{IVs} and controller knowledge to solve this issue in \ac{DeePC}. The aim of this article is to develop a \ac{CL-DeePC} method that does not rely \ac{IVs} to solve the aforementioned closed-loop identification issue, but may use \ac{IVs} as an additional noise-mitigation technique.
%To this end, the aim of this paper is to develop a \ac{CL-DeePC}\footnote{Henceforth this abbreviation will be used to distinguish it from regular \ac{DeePC}, as developed in~\citep{Coulson2019}.} method that does not suffer from the aforementioned closed-loop identification issue.
% In doing so, the main contributions of this article are: %
\begin{enumerate}%
\item[1.] to formally establish \acf{CL-DeePC} as a new behavioural \ac{DDPC} method, \label{contribution:develop_CL_DeePC}
% \item the evaluation of different possible \ac{CL-DeePC} implementations,
\item[2.] to incorporate \ac{IVs} in \ac{CL-DeePC} as a systematic noise-mitigation technique to provide consistent single or multiple-step-ahead predictors, \label{contribution:incorporate_IVs}
\item[3.] to present a unified \ac{CL-DeePC} framework that solves the closed-loop identification problem that arises in the presence of feedback and noise by sequential application of such consistent predictors,\label{contribution:solves_CL_issue}
\item[4.] to present a computationally efficient \ac{CL-DeePC} implementation that reveals an equivalence between \ac{CL-DeePC} and \ac{CL-SPC},
\item[5.] to show the superior performance of \ac{CL-DeePC} compared to \ac{DeePC} in a simulation example.
\end{enumerate}
%
%This paper builds on the authors' previous work.
%In~\cite{vanWingerden2022} \ac{IVs} are first incorporated with \ac{DeePC} to show equivalence with \ac{SPC}. This paper specifically considers \ac{IVs} that are suitable for closed-loop operation to develop \ac{CL-DeePC} and establish an equivalence with \ac{CL-SPC}. Furthermore, where~\cite{Dinkla2023} illustrates a closed-loop identification issue for batchwise-adaptive \ac{DDPC}, this work exhibits this issue for fully adaptive \ac{DDPC} and develops a unified \ac{CL-DeePC} approach to tackle this challenge.

This paper is structured as follows. \secref{sec:prelim} introduces the used system model and notation. In \secref{sec:CL-DeePC} \ac{CL-DeePC} is developed using \ac{IVs} to obtain a unified behavioural \ac{DDPC} framework that encompasses both consistent sequential single and multi-step-ahead predictions. \secref{sec:Sequential} develops a computationally efficient \ac{CL-DeePC} implementation for which \secref{sec:equivalence2CLSPC} subsequently reveals an equivalence with \ac{CL-SPC}. \secref{sec:simulation_setup} presents the setup of simulations that demonstrate a closed-loop identifcation issue in \secref{sec:CL_ID_issue} and enable a parametric sensitivity study in \secref{sec:sensitivity_study}. Finally, conclusions are presented in \secref{sec:conclusion}.

%
%The remainder of this paper is structured as follows. \secref{sec:prelim} introduces the considered system model, notation and definitions. \secref{sec:CL-DeePC} develops \ac{CL-DeePC}, thereby providing~C1. \ac{IVs} are first employed together with sequential consistent step-ahead predictions before generalizing to a unified framework that facilitates consistent multi-step-ahead predictions, thereby providing~C2 and~C3. \secref{sec:Sequential} presents a computationally efficient implementation of \ac{CL-DeePC} based on sequential single-step-ahead predictions that is shown to be equivalent to \ac{CL-SPC} in \secref{sec:equivalence2CLSPC}, thus providing~C4. \secref{sec:simulation_setup} presents the simulation setup. Simulations illustrate the closed-loop identification issue in \secref{sec:CL_ID_issue} and enable a parametric sensitivity study in \secref{sec:sensitivity_study} that provide~C5.